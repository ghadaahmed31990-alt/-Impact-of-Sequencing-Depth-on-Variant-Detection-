GIAB Pipeline Scripts - READMEThis directory contains workflow files for the GATK Best Practices preprocessing pipeline, configured to run on a 16 GB RAM system using Cromwell.---üìÅ Files in This Directory```scripts/‚îú‚îÄ‚îÄ bam-to-unmapped-bams.wdl                          # Step 1 workflow‚îú‚îÄ‚îÄ bam-to-unmapped-bams.inputs.json                  # Step 1 inputs‚îú‚îÄ‚îÄ processing-for-variant-discovery-gatk4.wdl        # Step 2 workflow (MODIFIED)‚îú‚îÄ‚îÄ processing-for-variant-discovery-gatk4.inputs.json # Step 2 inputs‚îú‚îÄ‚îÄ flowcell_unmapped_bams_list.txt                   # List of uBAM files‚îú‚îÄ‚îÄ cromwell.conf                                      # Cromwell config (MODIFIED)‚îî‚îÄ‚îÄ README.md                                          # This file```---üîß Modifications for 16 GB RAM SystemThe original workflows were designed for Google Cloud with unlimited resources. We made the following modifications to run successfully on a 16 GB RAM local system.---1. Cromwell Configuration (cromwell.conf)Modified Settings:Docker Memory Limit```hoconsubmit-docker = """  docker run --rm -i --cpus=4 --memory=15g --memory-swap=15g ...```Changed from: 8 GB (original caused failures)Changed to: 15 GBWhy: BWA-MEM task needs 14 GB; leaves 1 GB for OSConcurrent Job Limit```hoconconcurrent-job-limit = 1```Why: Prevents multiple memory-intensive tasks from running simultaneouslyResult: Only 1 task runs at a time, preventing out-of-memory errorsJob Rate Control```hoconjob-rate-control {  jobs = 1  per = 2 seconds}```Why: Prevents system overload by spacing out task launches---2. WDL Workflow ModificationFile: `processing-for-variant-discovery-gatk4.wdl`Task Modified: `BaseRecalibrator`Memory Settings ChangedOriginal (failed):```wdlFloat mem_size_gb = 6Int command_mem_gb = ceil(mem_size_gb) - 2  # = 4 GB```Modified (works):```wdlFloat mem_size_gb = 3.5Int command_mem_gb = 2```Java Options ChangedOriginal:```wdl--java-options "-Xms~{command_mem_gb}G"```Modified:```wdl--java-options "-Xms2G -Xmx2G"```Why These Changes:Reduced container memory from 6 GB ‚Üí 3.5 GBFixed Java heap to 2 GB to prevent exceeding limitsAllows task to run safely within Docker's 15 GB limit---3. WSL ConfigurationFile Location: `C:\Users\[YourUsername]\.wslconfig` (on Windows)Working Configuration (for 16 GB physical RAM):```ini[wsl2]memory=16GBprocessors=8swap=8GBlocalhostForwarding=true```Settings Explained:`memory=16GB` - Allocates all available RAM to WSL`processors=8` - Uses all CPU cores`swap=8GB` - Provides extra virtual memory if needed`localhostForwarding=true` - Allows Windows to access WSL servicesAfter Modifying This File: Restart WSL in PowerShell (as Administrator)```powershellwsl --shutdown```---4. JSON Input FilesBoth JSON files define workflow inputs. All file paths must be absolute paths pointing to your local directories.bam-to-unmapped-bams.inputs.jsonPurpose: Specifies input for converting aligned BAM to unmapped BAMComplete Example:```json{  "BamToUnmappedBams.input_bam": "/root/giab_project/data/bam/151002_7001448_0359_AC7F6GANXX_Sample_HG002-EEogPU_v02-KIT-Av5_AGATGTAC_L008.posiSrt.markDup.bam"}```What to modify:Update `input_bam` path to your aligned BAM file locationMust be absolute path (starting with `/`)---processing-for-variant-discovery-gatk4.hg38.wgs.inputs.jsonPurpose: Specifies all inputs for the main preprocessing workflowComplete Example (as configured for this project):```json{  "PreProcessingForVariantDiscovery_GATK4.sample_name": "HG002",  "PreProcessingForVariantDiscovery_GATK4.ref_name": "hg38",  "PreProcessingForVariantDiscovery_GATK4.flowcell_unmapped_bams_list": "/root/giab_project/scripts/flowcell_unmapped_bams_list.txt",  "PreProcessingForVariantDiscovery_GATK4.unmapped_bam_suffix": ".unmapped.bam",  "PreProcessingForVariantDiscovery_GATK4.ref_dict": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.dict",  "PreProcessingForVariantDiscovery_GATK4.ref_fasta": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta",  "PreProcessingForVariantDiscovery_GATK4.ref_fasta_index": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta.fai",  "PreProcessingForVariantDiscovery_GATK4.ref_alt": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta.64.alt",  "PreProcessingForVariantDiscovery_GATK4.ref_sa": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta.64.sa",  "PreProcessingForVariantDiscovery_GATK4.ref_amb": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta.64.amb",  "PreProcessingForVariantDiscovery_GATK4.ref_bwt": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta.64.bwt",  "PreProcessingForVariantDiscovery_GATK4.ref_ann": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta.64.ann",  "PreProcessingForVariantDiscovery_GATK4.ref_pac": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.fasta.64.pac",  "PreProcessingForVariantDiscovery_GATK4.dbSNP_vcf": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.dbsnp138.vcf.gz",  "PreProcessingForVariantDiscovery_GATK4.dbSNP_vcf_index": "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.dbsnp138.vcf.gz.tbi",  "PreProcessingForVariantDiscovery_GATK4.known_indels_sites_VCFs": [    "/root/giab_project/reference/hg38/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz",    "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.known_indels.vcf.gz"  ],  "PreProcessingForVariantDiscovery_GATK4.known_indels_sites_indices": [    "/root/giab_project/reference/hg38/Mills_and_1000G_gold_standard.indels.hg38.vcf.gz.tbi",    "/root/giab_project/reference/hg38/Homo_sapiens_assembly38.known_indels.vcf.gz.tbi"  ]}```Parameters Explained:Sample Information:`sample_name` - Sample identifier (e.g., HG002)`ref_name` - Reference genome version (e.g., hg38)Input Files:`flowcell_unmapped_bams_list` - Text file listing all unmapped BAM files`unmapped_bam_suffix` - File extension for unmapped BAMs (`.unmapped.bam`)Reference Genome Files:`ref_fasta` - Reference FASTA file`ref_fasta_index` - FASTA index (.fai)`ref_dict` - Sequence dictionary (.dict)`ref_alt` - ALT contigs file (for hg38)`ref_sa`, `ref_amb`, `ref_ann`, `ref_bwt`, `ref_pac` - BWA index filesKnown Variant Sites (for BQSR):`dbSNP_vcf` - dbSNP database VCF`dbSNP_vcf_index` - dbSNP VCF index (.tbi)`known_indels_sites_VCFs` - Array of known indel VCF files`known_indels_sites_indices` - Array of corresponding VCF indicesWhat to modify:Update all file paths to match your directory structureVerify all files exist before runningKeep the same parameter names (don't rename)------flowcell_unmapped_bams_list.txtPurpose: Lists paths to unmapped BAM files for the preprocessing workflowFormat: Simple text file with one file path per lineExample (single file):```/root/giab_project/data/bam/Sample_HG002_chr22.unmapped.bam```Example (multiple files):```/root/giab_project/data/bam/Sample_HG002_L001.unmapped.bam/root/giab_project/data/bam/Sample_HG002_L002.unmapped.bam/root/giab_project/data/bam/Sample_HG002_L003.unmapped.bam```Requirements:All files must end with `.unmapped.bam` suffixFiles must be query-sortedFiles must have proper read group (RG) tagsUse absolute pathsWhat to modify:List all your unmapped BAM files (one per line)Ensure paths are correct and files exist---üìä Memory Architecture Summary```System Configuration (16 GB Physical RAM):Total RAM:              16 GB‚îú‚îÄ WSL Allocation:      16 GB (set in .wslconfig)   ‚îú‚îÄ WSL overhead:     ~1 GB   ‚îî‚îÄ Docker container: 15 GB (limit set in cromwell.conf)      ‚îî‚îÄ Tasks run one at a time (concurrent-job-limit = 1):         ‚îú‚îÄ BWA-MEM:       14 GB (largest task)         ‚îú‚îÄ BaseRecalib:   3.5 GB (modified from 6 GB)         ‚îî‚îÄ Other tasks:   2-4 GB each```Why This Works:WSL uses entire 16 GB RAMDocker containers limited to 15 GB (leaves 1 GB for WSL overhead)Only 1 task runs at a time (concurrent-job-limit = 1)Largest task (BWA-MEM) needs 14 GB, fits within 15 GB Docker limitBaseRecalibrator reduced to 3.5 GB to prevent memory issuesSystem stays stable with sequential task execution---üéØ Key Points to RememberAll modifications work together:WSL gets 16 GB allocation (entire physical RAM)Docker containers limited to 15 GBOnly 1 task runs at a timeBaseRecalibrator reduced to 3.5 GBAlways use absolute paths in JSON filesDo not modify the WDL files except for the BaseRecalibrator memory settings shown aboveRestart WSL after changing `.wslconfig`Cromwell JVM memory: Use `-Xmx2g` when running Cromwell (for Cromwell itself, not tasks)---üöÄ Running the PipelineCommand:```bashjava -Xmx2g -Dconfig.file=cromwell.conf -jar cromwell.jar run \  ~/giab_project/scripts/processing-for-variant-discovery-gatk4.wdl \  --inputs ~/giab_project/scripts/processing-for-variant-discovery-gatk4.hg38.wgs.inputs.json```What this does:`-Xmx2g` - Allocates 2 GB to Cromwell's JVM`-Dconfig.file=cromwell.conf` - Uses your custom configuration`run` - Executes the workflowPoints to WDL workflow and JSON inputs files---üìù NotesThe `bam-to-unmapped-bams.wdl` requires no modifications and works as-isThe main preprocessing WDL only needs the BaseRecalibrator memory changeThese settings are optimized for 16 GB RAM systemsPipeline execution takes several hours for whole genome data (faster for chr22)For systems with more RAM, you can increase memory limits proportionally---Configuration tested on: WSL2, Ubuntu, 16 GB RAM, 8 CPU cores